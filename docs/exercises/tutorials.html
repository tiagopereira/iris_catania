

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Tutorials &mdash; Exercises for the IRIS Catania Workshop</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Exercises for the IRIS Catania Workshop" href="index.html"/>
        <link rel="next" title="4. Operations exercise questions" href="exercises_operations.html"/>
        <link rel="prev" title="2. Exercise questions" href="questions.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Exercises for the IRIS Catania Workshop</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">2. Exercise questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="questions.html#iris-and-data">2.1. IRIS and data</a></li>
<li class="toctree-l2"><a class="reference internal" href="questions.html#iris-spectral-lines">2.2. IRIS spectral lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="questions.html#crispex">2.3. CRISPEX</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">3. Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparation">3.1. Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iris-xfiles">3.2. IRIS xfiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mg-ii-dopplergrams">3.3. Mg II Dopplergrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mg-ii-spectral-feature-identification">3.4. Mg II spectral feature identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crispex">3.5. CRISPEX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exercises_operations.html">4. Operations exercise questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="exercises_operations.html#flare-ribbons">4.1. Flare Ribbons</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises_operations.html#network-jets">4.2. Network Jets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">5. Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="projects.html#spicules-fibrils-on-limb-and-off-limb">5.1. Spicules/fibrils on limb and off-limb</a></li>
<li class="toctree-l2"><a class="reference internal" href="projects.html#sunspot-waves">5.2. Sunspot waves</a></li>
<li class="toctree-l2"><a class="reference internal" href="projects.html#comparing-synthetic-with-iris-observations">5.3. Comparing synthetic with IRIS observations</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Exercises for the IRIS Catania Workshop</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>3. Tutorials</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="tutorials">
<h1>3. Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h1>
<p>These tutorials comprise step-by-step instructions and exercises to perform some tasks with IRIS data and CRISPEX. As time allows, these will be done by participants in the tutorial session. Most of these tutorials are also included in <a class="reference external" href="http://iris.lmsal.com/itn26/tutorials.html">section 8</a> of the User&#8217;s Guide to IRIS Data Analysis (<a class="reference external" href="http://iris.lmsal.com/itn26">ITN 26</a>).</p>
<div class="section" id="preparation">
<h2>3.1. Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>The data files for these tutorials were hopefully passed on to participants before. Otherwise, they can be downloaded from <a class="reference external" href="http://folk.uio.no/tiago/iris_catania/IRISdata.tar.bz2">http://folk.uio.no/tiago/iris_catania/IRISdata.tar.bz2</a> (1.9 Gb) or <a class="reference external" href="http://folk.uio.no/tiago/iris_catania/IRISdata.zip">http://folk.uio.no/tiago/iris_catania/IRISdata.zip</a> (2.6 Gb). This file contains several datasets from IRIS. Throughout the tutorials it is assumed that this file is unpacked into a directory called <tt class="docutils literal"><span class="pre">~/data_temp/</span></tt>. If you want to use a different directory, just replace the name when necessary.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The data file upacks to about 6 Gb in size. Please make sure you have at least 10 Gb of free disk space (ideally 12 Gb) to keep all the data and temporary files. Unpacking will take about 5-15 minutes.</p>
</div>
<p>To start, unpack the files into a directory in your computer:</p>
<div class="highlight-python"><div class="highlight"><pre>% mkdir ~/data_temp
% tar jxvf IRISdata.tar.bz2 -C ~/data_temp
(...)
</pre></div>
</div>
<p>Make sure you are in the same directory as the <tt class="docutils literal"><span class="pre">IRISdata.tar.bz2</span></tt> file. This will create a directory <tt class="docutils literal"><span class="pre">~/data_temp/iris</span></tt> with three subdirectories, one per dataset.</p>
<p>You will need to make sure that you have a up-to-date version of <a class="reference external" href="http://www.lmsal.com/solarsoft/">SolarSoft IDL</a> with the IRIS branch. You&#8217;ll need to have included <tt class="docutils literal"><span class="pre">iris</span></tt> in the <tt class="docutils literal"><span class="pre">SSW_INSTR</span></tt> environment variable, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>setenv SSW_INSTR &quot;sot iris ontology&quot;
</pre></div>
</div>
<p>If you have a working version of SolarSoft with the IRIS package you don&#8217;t need to do anything else.</p>
<p>It is outside the scope of these tutorials to help you install and configure SolarSoft. If you don&#8217;t have it already in your system we provide a tar file with a minimal version that can be used to run the tutorials. This minimal version of SolarSoft has not been tested in many platforms, and is not guaranteed to work. It should be used as a last resort only for those who didn&#8217;t have time to do a proper installation.  To install it, download the file <a class="reference external" href="http://folk.uio.no/tiago/iris5/ssw_iris_minimal.tar.bz2">http://folk.uio.no/tiago/iris5/ssw_iris_minimal.tar.bz2</a> (483 Mb) and unpack it to your home directory:</p>
<div class="highlight-python"><div class="highlight"><pre>tar jxvf ssw_iris_minimal.tar.bz2 -C ~/
</pre></div>
</div>
<p>(Again we assume the you are in the same directory as the file) This will create a directory <tt class="docutils literal"><span class="pre">~/ssw</span></tt> with an installation of SolarSoft. Now configure the startup file for your shell, typically <tt class="docutils literal"><span class="pre">~/.cshrc</span></tt> or <tt class="docutils literal"><span class="pre">~/.tcshrc</span></tt> (you MUST use csh or tcsh &#8211; bash et al. will not work). Add the following lines to your configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre>setenv SSW $HOME/ssw
setenv SSW_INSTR &quot;sot iris ontology&quot;
</pre></div>
</div>
<p>After that, start a new shell and type <tt class="docutils literal"><span class="pre">sswidl</span></tt>. If all went well you have SolarSoft working and are ready to run the tutorials!</p>
</div>
<div class="section" id="iris-xfiles">
<span id="xfiles-tut"></span><h2>3.2. IRIS xfiles<a class="headerlink" href="#iris-xfiles" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will guide you step-by-step into some features of <tt class="docutils literal"><span class="pre">iris_xfiles</span></tt>, a quicklook tool. Go to the directory with the IRIS data, open solarsoft IDL and launch <tt class="docutils literal"><span class="pre">iris_xfiles</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>% cd ~/data_temp/iris
% sswidl
(...)
IDL&gt; iris_xfiles
</pre></div>
</div>
<p>In the middle panel, next to <strong>Search Directory:</strong> press <strong>Change</strong>. Then navigate to the directory <tt class="docutils literal"><span class="pre">~/data_temp/iris/20131226_171752_3840007146</span></tt>, press <strong>OK</strong> when this directory is selected. Notice that <strong>Search Pattern</strong> changed to <strong>free search</strong>. Make sure the time of these observations (2013 December 26, 17:17 UT) is contained in between the <strong>Start Time</strong> and <strong>Stop Time</strong> range, adjust if necessary.</p>
<p>Now press <strong>Start Search</strong>, and you should see the list of files appear. Feel free to check the slit-jaw movies and then double click on the raster file. What can you say about the line list?</p>
<div class="figure">
<img alt="_images/xfiles_tut3.png" src="_images/xfiles_tut3.png" />
<p class="caption">How the wavelength selection <tt class="docutils literal"><span class="pre">iris_xfiles</span></tt> moment tool should look like.</p>
</div>
<p>Select the Si IV 1403 line and under <strong>Line fit</strong> select <strong>Profile Moments</strong>. On the <strong>Moments Prep Tool</strong> window adjust the reference wavelength so that it matches the core of the line, and set the line start and stop so that it covers the line. Set the continuum to be about 5-10 pixels wide on a region with no lines. Press <strong>Finished</strong> (and wait a while...). What do you see?</p>
<p>The result for intensity should look like this (set <cite>log(HistoOpt Value)</cite> to -1.65):</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/xfiles2.jpg"><img alt="_images/xfiles2.jpg" src="_images/xfiles2.jpg" style="width: 489.6px; height: 531.2px;" /></a>
</div>
<p>Now select the Mg II k 2796 line instead, and choose again <strong>Profile moments</strong>. Set the line start and stop so that it is about 5 pixels wide around k3. Set the continuum to be about 5 pixels wide on the right side of the plot, in a region with no absorption lines. The result for intensity should look like this:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/xfiles1.jpg"><img alt="_images/xfiles1.jpg" src="_images/xfiles1.jpg" style="width: 488.0px; height: 552.8px;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The single or double Gauss fit options in Line fit are not currently working.</p>
</div>
<p>Go back to the <tt class="docutils literal"><span class="pre">IRIS_Xcontrol</span></tt> window of the raster file. Select the Si IV 1403 and Mg II k 2796 lines and press <strong>Generate level3 files</strong>. In the next dialog select only <cite>add &#8220;20131226_171752_3840007146/&#8221; to save directory</cite>, so that the level 3 file is saved in the existing directory. We will use this level 3 file later with CRISPEX. Note that no <tt class="docutils literal"><span class="pre">sp</span></tt> file was created, as these observations comprise only a single 400-step raster.</p>
</div>
<div class="section" id="mg-ii-dopplergrams">
<h2>3.3. Mg II Dopplergrams<a class="headerlink" href="#mg-ii-dopplergrams" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we are going to produce a Dopplergram for the Mg II k line from an IRIS 400-step raster. The Dopplergram is obtained by subtracting the intensities at symmetrical velocity shifts from the line core (e.g. ±50 km/s). For this kind of analysis we need a consistent wavelength calibration for each step of the raster.</p>
<p>The data set directory should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">data_dir</span> <span class="o">=</span> <span class="s">&#39;~/data_temp/iris/20140708_114109_3824262996&#39;</span>
</pre></div>
</div>
<p>Feel free to examine these data in <tt class="docutils literal"><span class="pre">iris_xfiles</span></tt>. This very large dense raster took more than three hours to complete the 400 scans (30 s exposures), which means that the orbital velocity and thermal drifts were changed during the observations. This means that any precise wavelength calibration will need to correct for those shifts. In most cases level 2 data have already been corrected for these shifts, but this example shows a dataset for which the automatic calibration still left a significant component which must be corrected for.</p>
<p>First lets load the data using the IDL object interface:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;iris_l2_20140708_114109_3824262996_raster_t000_r00000.fits&#39;</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">iris_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Let us see the lines that are saved in this raster:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; d-&gt;show_lines
Spectral regions(windows)
0   1335.71   C II 1336
1   1349.43   Fe XII 1349
2   1355.60   O I 1356
3   1393.78   Si IV 1394
4   1402.77   Si IV 1403
5   2832.70   2832
6   2814.43   2814
7   2796.20   Mg II k 2796
</pre></div>
</div>
<p>Let us load the Mg II k line into memory:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; wave = d-&gt;getlam(7)
IDL&gt; data = d-&gt;getvar(7, /load)
</pre></div>
</div>
<p>We can see how the the spatially averaged spectrum looks like:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; mspec = total(total(data, 2), 2)
IDL&gt; plot, wave, mspec
IDL&gt; plot, wave, mspec, xrange=[2794, 2799], /xst
</pre></div>
</div>
<p>To better understand the orbital velocity problem let us look at how the line intensity varies for a strong Mn I line at around 280.2 nm, in between the Mg II k and h lines. For this dataset, the line core of this line falls around index 350. To plot it in the correct orientation we will make use of IDL&#8217;s <tt class="docutils literal"><span class="pre">rotate</span></tt>, and the procedure <tt class="docutils literal"><span class="pre">pih</span></tt> (available in the IRIS tree of solarsoft) to make the plot:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; pih, rotate(reform(data[350, *, *]), 1), min=0, max=200, scale=[0.35, 0.1667]
</pre></div>
</div>
<p>The result should look like this:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/spic_wave1.png"><img alt="_images/spic_wave1.png" src="_images/spic_wave1.png" style="width: 369.75px; height: 462.4px;" /></a>
<p class="caption">Intensity at Mn I 280.2 nm line when orbital velocity and thermal drifts are <strong>not</strong> accounted for.</p>
</div>
<p>You can see that the left side of the figure is brighter, and indication that its intensities are not taken at the same position in the line because of wavelength shifts.</p>
<p>To calculate the wavelength shifts from the orbital velocity and thermal drifts we do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">wavecorr</span> <span class="o">=</span> <span class="n">iris_prep_wavecorr_l2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>This routine measures the wavelength position of 5 neutral lines (3 NUV, 2 FUV) whose rest wavelengths are reasonably well known, and saves the shifts (in Ångström) into the structure variable called <tt class="docutils literal"><span class="pre">wavecorr</span></tt>.</p>
<p>The wavelength shift in the i-th line in the j-th frame of the k-th input file is stored in <tt class="docutils literal"><span class="pre">wavecorr.corrs[k,</span> <span class="pre">j,</span> <span class="pre">i]</span></tt> . Averaged and smoothed corrections for the NUV and FUV are stored in <tt class="docutils literal"><span class="pre">corr_nuv</span></tt> and <tt class="docutils literal"><span class="pre">corr_fuv</span></tt>. To plot the per-frame measured wavelength shift and the smoothed correction in the NUV and FUV one would do:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; utplot, wavecorr.times, wavecorr.corrs[0,*,0], psym = 4, chars = 1.5, title = &#39;NUV&#39;, ytitle = &#39;Wavelength shift [A]&#39;, /xst
IDL&gt; outplot, wavecorr.times, wavecorr.corr_nuv, col = 2, thick = 2
</pre></div>
</div>
<div class="figure">
<img alt="_images/orbitvar_corr2.png" src="_images/orbitvar_corr2.png" />
<p class="caption">Fit to the orbital velocity/thermal shifts from <tt class="docutils literal"><span class="pre">iris_prep_wavecorr_l2</span></tt>.</p>
</div>
<p>To look at intensities at any given scan we only need to subtract this shift from the wavelength scale, but to look at the whole image at a given wavelength we must interpolate the original data to take this shift into account. Here is a way to do it (note that array dimensions apply to this specific set only!):</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; new_data = fltarr(536, 1094, 400, /n)
IDL&gt; ; subtract mean shift
IDL&gt; wavecorr.corr_nuv = wavecorr.corr_nuv - mean(wavecorr.corr_nuv)
IDL&gt; .r
for i=0, 399 do begin
   for j=0, 1093 do begin
       new_data[*, j, i] = interpol(data[*, j, i], wave + wavecorr.corr_nuv[i], wave)
   endfor
endfor
end
</pre></div>
</div>
<p>(This double loop may take a while to complete.)</p>
<p>Once you have the calibrated data, we can compare again how it looks at the Mn I line wavelength:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; pih, rotate(reform(new_data[350, *, *]), 1), min=0, max=200, scale=[0.35, 0.1667]
</pre></div>
</div>
<p>And now we can see that the intensity map is uniform along the solar disk:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/spic_wave2.png"><img alt="_images/spic_wave2.png" src="_images/spic_wave2.png" style="width: 369.75px; height: 461.55px;" /></a>
<p class="caption">Intensity at Mn I 280.2 nm line when orbital velocity and thermal drifts are accounted for.</p>
</div>
<p>We can use this calibrated data for example to calculate dopplergrams. A dopplergram is the difference between the intensities at two wavelength positions at the same (and opposite) distance from the line core. For example, at +/- 50 km/s from the Mg II k3 core. To do this, let us first calculate a velocity scale for the k line and find the indices of the -50 and +50 km/s velocity positions:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; k_centre = 2796.31
IDL&gt; vel = (k_centre - wave) * 3e5 / k_centre
IDL&gt; ; find index of -50 and 50 km/s
IDL&gt; tmp = min(abs(vel - 50), i50p)
IDL&gt; tmp = min(abs(vel + 50), i50m)
</pre></div>
</div>
<p>Now get the dopplergram and plot it:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; doppgr = rotate(reform(new_data[i50m, *, *] - new_data[i50p, *, *]), 1)
IDL&gt; pih, doppgr, min=-30, max=30, scale=[0.35, 0.1667]
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="_images/spic_dopp.png"><img alt="_images/spic_dopp.png" src="_images/spic_dopp.png" style="width: 363.8px; height: 462.4px;" /></a>
<p class="caption">Dopplegram for Mg II k at +/- 50 km/s.</p>
</div>
</div>
<div class="section" id="mg-ii-spectral-feature-identification">
<h2>3.4. Mg II spectral feature identification<a class="headerlink" href="#mg-ii-spectral-feature-identification" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will measure the intensities and velocity shifts of the Mg II k3 and k2 features. We will make use of the <tt class="docutils literal"><span class="pre">iris_get_mg_features_lev2</span></tt> procedure, which is included in the IRIS SSW package.</p>
<p>Here we will use the same dataset as for the tutorial <a class="reference internal" href="#xfiles-tut"><em>IRIS xfiles</em></a> above. The files can be loaded like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">data_dir</span> <span class="o">=</span> <span class="s">&#39;~/data_temp/iris/20131226_171752_3840007146&#39;</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;iris_l2_20131226_171752_3840007146_raster_t000_r00000.fits&#39;</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
</pre></div>
</div>
<p>We can calculate the properties of the Mg II k line in the following manner:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; iris_get_mg_features_lev2, filename, 3, [-40, 40], lc, rp, bp, /onlyk
</pre></div>
</div>
<p>The output was saved in the arrays <cite>lc</cite> (line centre), <cite>rp</cite> (red peak), and <cite>bp</cite> (blue peak). To save time we calculated only for the k line. We can then visualise both the derived velocities and intensities. For the intensities:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; pih, rotate(reform(lc[0, 1, *, *]), 1), min=0, max=500,  scale=[0.35, 0.1667]
IDL&gt; pih, rotate(reform(bp[0, 1, *, *]), 1), min=0, max=750,  scale=[0.35, 0.1667]
IDL&gt; pih, rotate(reform(rp[0, 1, *, *]), 1), min=0, max=750,  scale=[0.35, 0.1667]
</pre></div>
</div>
<div class="figure">
<img alt="_images/mgfeat_k3i.png" src="_images/mgfeat_k3i.png" />
<p class="caption">Intensity for the k3 peak from <tt class="docutils literal"><span class="pre">iris_get_mg_features</span></tt>.</p>
</div>
<p>and for the velocities:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; pih, rotate(reform(lc[0, 0, *, *]), 1), min=-15, max=15,  scale=[0.35, 0.1667]
IDL&gt; pih, rotate(reform(rp[0, 0, *, *]), 1), min=0, max=30,  scale=[0.35, 0.1667]
IDL&gt; pih, rotate(reform(bp[0, 0, *, *]), 1), min=-30, max=0,  scale=[0.35, 0.1667]
</pre></div>
</div>
<div class="figure">
<img alt="_images/mgfeat_k3v.png" src="_images/mgfeat_k3v.png" />
<p class="caption">Velocity shifts for the k3 peak from <tt class="docutils literal"><span class="pre">iris_get_mg_features</span></tt>.</p>
</div>
</div>
<div class="section" id="crispex">
<h2>3.5. CRISPEX<a class="headerlink" href="#crispex" title="Permalink to this headline">¶</a></h2>
<div class="section" id="active-region-400-step-raster">
<h3>3.5.1. Active region 400-step raster<a class="headerlink" href="#active-region-400-step-raster" title="Permalink to this headline">¶</a></h3>
<p>Let us go back to the directory of the first dataset we worked with, and run CRISPEX on the level 3 file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">cd</span><span class="p">,</span> <span class="s">&#39;~/data_temp/iris/20131226_171752_3840007146&#39;</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">crispex</span><span class="p">,</span> <span class="s">&#39;iris_l3_20131226_171752_3840007146_t000_SiIV1403_MgIIk2796_im.fits&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you haven&#8217;t created the level 3 file with <tt class="docutils literal"><span class="pre">iris_xfiles</span></tt>, you can create it quickly
from the IDL command line (assuming you are at the directory with the level 2 files):</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s">&#39;*raster*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">iris_make_fits_level3</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Explore the dataset with CRISPEX, and go through the following tasks/questions:</p>
<ul class="simple">
<li>Adjust the scaling of the spectral plot so that the lines are visible (<cite>Displays</cite> tab, lower/upper y-values, and also multipliers in <cite>Scaling</cite> tab under <cite>Detailed spectrum</cite>)</li>
<li>Look at the main image in the cores of the Mg II k and Si IV lines. Adjust scaling for Si IV 1403 so that it becomes visible (change <cite>Histogram optimisation</cite> to 0.001 and/or set gamma lower than 1)</li>
<li>Blink the image between the spectral positions of the cores of the  Si IV and Mg II k lines (use animation speed of about 2 frames/s)</li>
<li>Can you find a large dot where Si IV is greatly enhanced but Mg II is not too unusual? What are its solar (x, y) coordinates?</li>
<li>Is there a sunspot or a pore in these observations? How do you find out?</li>
</ul>
</div>
<div class="section" id="flare-4-step-raster">
<h3>3.5.2. Flare 4-step raster<a class="headerlink" href="#flare-4-step-raster" title="Permalink to this headline">¶</a></h3>
<p>Now let us look at a different type of IRIS observation, a 4-step dense raster with 80 repeats during which a flare was caught. Please download and uncompress the <a class="reference external" href="http://www.lmsal.com/solarsoft/irisa/data/level2_compressed/2014/11/07/20141107_160734_3860258971/iris_l2_20141107_160734_3860258971_raster.tar.gz">raster file</a>, the <a class="reference external" href="http://www.lmsal.com/solarsoft/irisa/data/level2_compressed/2014/11/07/20141107_160734_3860258971/iris_l2_20141107_160734_3860258971_SJI_1330_t000.fits.gz">1330</a>, <a class="reference external" href="http://www.lmsal.com/solarsoft/irisa/data/level2_compressed/2014/11/07/20141107_160734_3860258971/iris_l2_20141107_160734_3860258971_SJI_2796_t000.fits.gz">2796</a>, and <a class="reference external" href="http://www.lmsal.com/solarsoft/irisa/data/level2_compressed/2014/11/07/20141107_160734_3860258971/iris_l2_20141107_160734_3860258971_SJI_2832_t000.fits.gz">2832</a> SJIs. Then we need to produce the level 3 files for this dataset, so let us change directory and do that from IDL:</p>
<div class="highlight-python"><div class="highlight"><pre>IDL&gt; cd, &#39;~/data_temp/iris/20141107_160734_3860258971&#39;
IDL&gt; f = iris_files(&#39;*raster*&#39;)
IDL&gt; ; make level 3 files with C II, Si IV, and Mg II (indices 0, 3, 7)
IDL&gt; iris_make_fits_level3, f, [0, 4, 8], /sp
</pre></div>
</div>
<p>Let us now run CRISPEX using both im and sp files, and also use a slit-jaw image:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">l3files</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s">&#39;iris_l3*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">sji</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s">&#39;*SJI*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">crispex</span><span class="p">,</span> <span class="n">l3files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l3files</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sjicube</span><span class="o">=</span><span class="n">sji</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>When CRISPEX opens, you can see multiple windows, including the slit-jaw image with the 4 raster positions superimposed.</p>
<p>In CRISPEX the visualisation of this dataset has both a time domain and a main image with 16 columns. Feel free to explore this dataset, first by creating the level 3 files and loading them in CRISPEX. When used with a <tt class="docutils literal"><span class="pre">sjicube</span></tt> option, one can see the 4 positions superimposed in the slit-jaw image.</p>
<p>Explore the dataset with CRISPEX, and go through the following tasks/questions:</p>
<ul class="simple">
<li>Start running the time sequence. At what time does this observation finish?</li>
<li>Is there a sympathetic flare in the same region?</li>
<li>Adjust the slit-jaw image scaling so you can see more than the flare ribbons</li>
<li>At frame 48, the slit-jaw image overall intensity gets much lower. Why is that?</li>
<li>Show only the Mg II lines (<cite>Diagnostics</cite> tab, unselect other lines and then <cite>Spectral</cite> tab, narrow down Doppler minimum/maximum values)</li>
<li>Lock the mouse at a given position, see how the temporal evolution goes through the <cite>Spectral T-slice</cite> window</li>
<li>Can you find a location with the Mg II triplet lines in emission?</li>
</ul>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="exercises_operations.html" class="btn btn-neutral float-right" title="4. Operations exercise questions"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="questions.html" class="btn btn-neutral" title="2. Exercise questions"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>